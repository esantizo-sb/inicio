const classData = [
  {
    grade: '3ro B',
    code: 'UFHRDM',
    joinLink: 'https://frm.tv/join/UFHRDM'
  },
  {
    grade: '3ro A',
    code: 'MVQUE4',
    joinLink: 'https://frm.tv/join/MVQUE4'
  },
  {
    grade: '4to A',
    code: 'PC5CGF',
    joinLink: 'https://frm.tv/join/PC5CGF'
  },
  {
    grade: '4to B',
    code: '6HKH4B',
    joinLink: 'https://frm.tv/join/6HKH4B'
  },
  {
    grade: '5to A',
    code: 'V5L558',
    joinLink: 'https://frm.tv/join/V5L558'
  },
  {
    grade: '5to B',
    code: 'N8LTER',
    joinLink: 'https://frm.tv/join/N8LTER'
  },
  {
    grade: '6to A',
    code: 'HT3SZE',
    joinLink: 'https://frm.tv/join/HT3SZE'
  },
  {
    grade: '6to B',
    code: 'NLNAD9',
    joinLink: 'https://frm.tv/join/NLNAD9'
  },
  {
    grade: '7mo A',
    code: 'VJMD4Q',
    joinLink: 'https://frm.tv/join/VJMD4Q'
  },
  {
    grade: '7mo B',
    code: '32RZGH',
    joinLink: 'https://frm.tv/join/32RZGH'
  },
  {
    grade: '8vo A',
    code: 'TWVA8H',
    joinLink: 'https://frm.tv/join/TWVA8H'
  },
  {
    grade: '8vo B',
    code: 'GM8GSK',
    joinLink: 'https://frm.tv/join/GM8GSK'
  },
  {
    grade: '8vo C',
    code: 'YRKTVL',
    joinLink: 'https://frm.tv/join/YRKTVL'
  },
  {
    grade: '9no A',
    code: 'BR5R4V',
    joinLink: 'https://frm.tv/join/BR5R4V'
  },
  {
    grade: '9no B',
    code: 'TQDUAA',
    joinLink: 'https://frm.tv/join/TQDUAA'
  },
  {
    grade: '10mo A',
    code: 'XCMQEX',
    joinLink: 'https://frm.tv/join/XCMQEX'
  },
  {
    grade: '10mo B',
    code: 'Q68FZQ',
    joinLink: 'https://frm.tv/join/Q68FZQ'
  },
  {
    grade: '11mo A',
    code: 'C3GJZC',
    joinLink: 'https://frm.tv/join/C3GJZC'
  },
  {
    grade: '11mo B',
    code: 'M9R3LA',
    joinLink: 'https://frm.tv/join/M9R3LA'
  },
  {
    grade: 'Escuelita 4to',
    code: 'JBUY49',
    joinLink: 'https://frm.tv/join/JBUY49'
  },
  {
    grade: 'Escuelita 5to',
    code: 'H989YB',
    joinLink: 'https://frm.tv/join/H989YB'
  },
  {
    grade: 'Escuelita 6to',
    code: 'TTVDQX',
    joinLink: 'https://frm.tv/join/TTVDQX'
  }
];

const computerClasses = [
  {
    grade: '3th A - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc3NjQyNDc2?cjc=mi46jyt'
  },
  {
    grade: '3th B - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc4MTc3NTAy?cjc=37kixqv'
  },
  {
    grade: '4th A - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc4NDQyODE3?cjc=nvilo7w'
  },
  {
    grade: '4th B - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc3NTI1NjI0?cjc=qyvabdh'
  },
  {
    grade: '5th A - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc3Mjc0NzAw?cjc=2bkh7tt'
  },
  {
    grade: '5th B - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc4NDU2MTQx?cjc=pwwdlhf'
  },
  {
    grade: '6th A - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc3MTMzNzA0?cjc=qo72kvq'
  },
  {
    grade: '6th B - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc3ODg5ODI5?cjc=6ejc3p2'
  },
  {
    grade: '7th A - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc0Nzg0ODI5?cjc=aqsmsb3'
  },
  {
    grade: '7th B - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc2NDQ3OTQz?cjc=2r5r4h5'
  },
  {
    grade: '8th A - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc1NjY4OTUy?cjc=uy5nu6l'
  },
  {
    grade: '8th B - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc2MDQ3MzEy?cjc=cuvacm4'
  },
  {
    grade: '8th C - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc2MzM5ODA1?cjc=4rvhjmp'
  },
  {
    grade: '9th A - Computación',
    link: 'https://classroom.google.com/c/NzQ1MzczNTYzNzA1?cjc=hrxyltq'
  },
  {
    grade: '9th B - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc1ODc5MzE3?cjc=a4rovsv'
  },
  {
    grade: '10th A - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc1NDkyNDA0?cjc=msng6dp'
  },
  {
    grade: '10th B - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc2MTIxMzU3?cjc=3wifrgo'
  },
  {
    grade: '11th A - Computación',
    link: 'https://classroom.google.com/c/NzQ1Mzc2MTc1MDA3?cjc=2sxe2va'
  },
  {
    grade: '11th B - Computación',
    link: 'https://classroom.google.com/c/NzQ1MzU2MzMxNTk3?cjc=uzbeht6'
  }
];

document.addEventListener('DOMContentLoaded', () => {
  const classGrid = document.getElementById('classGrid');
  
  // Populate class cards
  classData.forEach(classInfo => {
    const card = document.createElement('div');
    card.className = 'class-card';
    card.innerHTML = `
      <h3>${classInfo.grade}</h3>
      <p>Código de inscripción:</p>
      <div class="code">${classInfo.code}</div>
      <a href="${classInfo.joinLink}" class="join-link">Unirse a la clase</a>
    `;
    classGrid.appendChild(card);
  });

  // Search functionality implementation
  const searchInput = document.getElementById('siteSearch');
  const searchButton = document.getElementById('searchButton');
  
  /**
   * Search function to filter content on the page
   * @param {string} query - The search text entered by user
   */
  function performSearch(query) {
    // Convert query to lowercase for case-insensitive search
    const searchTerm = query.toLowerCase();
    
    // Clear previous search highlights
    document.querySelectorAll('.highlight').forEach(el => {
      el.classList.remove('highlight');
    });
    
    // If search is empty, show all elements
    if (searchTerm === '') {
      showAllElements();
      return;
    }
    
    // Arrays to track which elements match
    const matchingCards = [];
    const matchingClassCards = [];
    
    // Search in platform cards
    const platformCards = document.querySelectorAll('.platform-card');
    platformCards.forEach(card => {
      const cardText = card.textContent.toLowerCase();
      if (cardText.includes(searchTerm)) {
        matchingCards.push(card);
        // Highlight matching text
        highlightText(card, searchTerm);
      }
    });
    
    // Search in class cards
    const classCards = document.querySelectorAll('.class-card');
    classCards.forEach(card => {
      const cardText = card.textContent.toLowerCase();
      if (cardText.includes(searchTerm)) {
        matchingClassCards.push(card);
        // Highlight matching text
        highlightText(card, searchTerm);
      }
    });
    
    // Hide non-matching platform cards
    platformCards.forEach(card => {
      if (!matchingCards.includes(card)) {
        card.style.display = 'none';
      } else {
        card.style.display = '';
      }
    });
    
    // Hide non-matching class cards
    classCards.forEach(card => {
      if (!matchingClassCards.includes(card)) {
        card.style.display = 'none';
      } else {
        card.style.display = '';
      }
    });
    
    // Show sections with matches, hide others
    checkSectionVisibility();
  }
  
  /**
   * Helper function to highlight matching text within an element
   * @param {Element} element - The DOM element to search within
   * @param {string} term - The search term to highlight
   */
  function highlightText(element, term) {
    // Get all text nodes within the element
    const walker = document.createTreeWalker(
      element,
      NodeFilter.SHOW_TEXT,
      null,
      false
    );
    
    const textNodes = [];
    let node;
    while ((node = walker.nextNode())) {
      textNodes.push(node);
    }
    
    // Process each text node
    textNodes.forEach(textNode => {
      const parent = textNode.parentNode;
      const content = textNode.textContent;
      const lowerContent = content.toLowerCase();
      
      if (lowerContent.includes(term)) {
        // Split text by the search term
        const parts = [];
        let lastIndex = 0;
        let index;
        
        while ((index = lowerContent.indexOf(term, lastIndex)) !== -1) {
          // Add text before match
          if (index > lastIndex) {
            parts.push(document.createTextNode(content.substring(lastIndex, index)));
          }
          
          // Add highlighted match
          const span = document.createElement('span');
          span.className = 'highlight';
          span.textContent = content.substring(index, index + term.length);
          parts.push(span);
          
          lastIndex = index + term.length;
        }
        
        // Add remaining text
        if (lastIndex < content.length) {
          parts.push(document.createTextNode(content.substring(lastIndex)));
        }
        
        // Replace original text node with highlighted parts
        if (parts.length > 0) {
          const fragment = document.createDocumentFragment();
          parts.forEach(part => fragment.appendChild(part));
          parent.replaceChild(fragment, textNode);
        }
      }
    });
  }
  
  /**
   * Check which sections have visible elements and hide empty sections
   */
  function checkSectionVisibility() {
    // Check platform section
    const platformGrid = document.querySelector('.platform-grid');
    const visiblePlatforms = Array.from(platformGrid.querySelectorAll('.platform-card')).filter(
      card => card.style.display !== 'none'
    );
    
    const platformsSection = document.querySelector('.platforms');
    platformsSection.style.display = visiblePlatforms.length > 0 ? '' : 'none';
    
    // Check class section
    const classGridEl = document.getElementById('classGrid');
    const visibleClasses = Array.from(classGridEl.querySelectorAll('.class-card')).filter(
      card => card.style.display !== 'none'
    );
    
    const classSection = document.querySelector('.class-codes');
    classSection.style.display = visibleClasses.length > 0 ? '' : 'none';
  }
  
  /**
   * Reset the page to show all elements
   */
  function showAllElements() {
    // Show all platform cards
    document.querySelectorAll('.platform-card').forEach(card => {
      card.style.display = '';
    });
    
    // Show all class cards
    document.querySelectorAll('.class-card').forEach(card => {
      card.style.display = '';
    });
    
    // Show all sections
    document.querySelector('.platforms').style.display = '';
    document.querySelector('.class-codes').style.display = '';
  }
  
  // Event listener for search button click
  searchButton.addEventListener('click', () => {
    performSearch(searchInput.value);
  });
  
  // Event listener for search input (search as you type)
  searchInput.addEventListener('input', () => {
    performSearch(searchInput.value);
  });
  
  // Event listener for pressing Enter in search field
  searchInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      performSearch(searchInput.value);
    }
  });

  // Smooth scrolling for navigation links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth'
        });
      }
    });
  });

  // Contact form handling
  const contactForm = document.getElementById('contactForm');
  contactForm.addEventListener('submit', (e) => {
    e.preventDefault();
    // Add form submission logic here
    alert('Mensaje enviado exitosamente!');
    contactForm.reset();
  });

  // Computer classes dropdown
  const computerSelect = document.getElementById('computerSelect');
  const goToClassBtn = document.getElementById('goToClassBtn');
  
  computerClasses.forEach(classInfo => {
    const option = document.createElement('option');
    option.value = classInfo.link;
    option.textContent = classInfo.grade;
    computerSelect.appendChild(option);
  });

  goToClassBtn.addEventListener('click', () => {
    const selectedValue = computerSelect.value;
    if (selectedValue) {
      window.open(selectedValue, '_blank');
    }
  });
});
